<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="main.css">
	<link href="https://fonts.googleapis.com/css?family=Lato:100" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://www.opencpu.org/js/archive/opencpu-0.4.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.5.2/firebase.js"></script>
	<script src = "firebase-init.js"></script>
	<script>

	  // Initialize Firebase


		ocpu.seturl("https://public.opencpu.org/ocpu/library/base/R")

		function regress(data) {
			var revenue = [];
			var age = [];
			var user = [];
			var contactEmail = [];
			var contactInPerson = [];
			var contactPhone = [];
			var industryContractor = [];
			var industryManufacturer = [];
			var industryRestaurant = [];
			var pitchLowerPrice = [];
			var pitchNegotiating = [];
			var pitchGroupPurchasing = [];
			var relationship = [];
			var sectorIndustrial = [];
			var sectorService =[];
			var sexM = [];
			var titleOwner = [];
			var titlePurchaser = [];
			var titleVP = [];
			var employees = [];

			Object.keys(data).forEach(function(k){
			    	revenue.push(data[k]["Revenue"]);
			    	age.push(data[k]["Age"]);	
			    	user.push(data[k]["User"]);	
			    	contactEmail.push(data[k]["Contact-Email"]);		    	
			    	contactInPerson.push(data[k]["Contact-In-Person"]);		    	
			    	contactPhone.push(data[k]["Contact-Phone"]);		    	
			    	industryContractor.push(data[k]["Industry-Contractor"]);		    	
			    	industryManufacturer.push(data[k]["Industry-Manufacturer"]);		    	
			    	industryRestaurant.push(data[k]["Industry-Restaurant"]);
			    	pitchGroupPurchasing.push(data[k]["Pitch-Group-Purchasing"]);		    	
 			    	pitchNegotiating.push(data[k]["Pitch-Negotiating"]);		    	
			    	pitchLowerPrice.push(data[k]["Pitch-Lower-Price"]);		
			    	relationship.push(data[k]["Relationship-Yes"]);   
			    	sectorIndustrial.push(data[k]["Sector-Industrial"]); 	
			    	sectorService.push(data[k]["Sector-Service"]);
			    	sexM.push(data[k]["Sex-M"]);
			    	titleOwner.push(data[k]["Title-Owner"]);
			    	titlePurchaser.push(data[k]["Title-Purchaser"]);
			    	titleVP.push(data[k]["Title-VP"]);
			    	employees.push(data[k]["Employees"]);

			});

			employeesVector = "c(";
			for(var i = 0;i < employees.length; i++) {
				if(i < employees.length-1) {employeesVector+=employees[i]+",";}
				else {employeesVector+=employees[i]+")";}
			}
			relationshipVector = "c(";
			for(var i = 0;i < relationship.length; i++) {
				if(i < relationship.length-1) {relationshipVector+=relationship[i]+",";}
				else {relationshipVector+=relationship[i]+")";}
			}
			sectorIndustrialVector = "c(";
			for(var i = 0;i < sectorIndustrial.length; i++) {
				if(i < sectorIndustrial.length-1) {sectorIndustrialVector+=sectorIndustrial[i]+",";}
				else {sectorIndustrialVector+=sectorIndustrial[i]+")";}
			}
			sectorServiceVector = "c(";
			for(var i = 0;i < sectorService.length; i++) {
				if(i < sectorService.length-1) {sectorServiceVector+=sectorService[i]+",";}
				else {sectorServiceVector+=sectorService[i]+")";}
			}
			sexMVector = "c(";
			for(var i = 0;i < sexM.length; i++) {
				if(i < sexM.length-1) {sexMVector+=sexM[i]+",";}
				else {sexMVector+=sexM[i]+")";}
			}
			titleOwnerVector = "c(";
			for(var i = 0;i < titleOwner.length; i++) {
				if(i < titleOwner.length-1) {titleOwnerVector+=titleOwner[i]+",";}
				else {titleOwnerVector+=titleOwner[i]+")";}
			}
			titlePurchaserVector = "c(";
			for(var i = 0;i < titlePurchaser.length; i++) {
				if(i < titlePurchaser.length-1) {titlePurchaserVector+=titlePurchaser[i]+",";}
				else {titlePurchaserVector+=titlePurchaser[i]+")";}
			}
			titleVPVector = "c(";
			for(var i = 0;i < titleVP.length; i++) {
				if(i < titleVP.length-1) {titleVPVector+=titleVP[i]+",";}
				else {titleVPVector+=titleVP[i]+")";}
			}

																					
			userVector = "c(";
			for(var i = 0;i < user.length; i++) {
				if(i < user.length-1) {userVector+=user[i]+",";}
				else {userVector+=user[i]+")";}
			}
			revenueVector = "c(";
			for(var i = 0;i < revenue.length; i++) {
				if(i < revenue.length-1) {revenueVector+=revenue[i]+",";}
				else {revenueVector+=revenue[i]+")";}
			}
			ageVector = "c(";
			for(var i = 0;i < age.length; i++) {
				if(i < age.length-1) {ageVector+=age[i]+",";}
				else {ageVector+=age[i]+")";}
			}
			contactEmailVector = "c(";
			for(var i = 0;i < contactEmail.length; i++) {
				if(i < contactEmail.length-1) {contactEmailVector+=contactEmail[i]+",";}
				else {contactEmailVector+=contactEmail[i]+")";}
			}		
			contactInPersonVector = "c(";
			for(var i = 0;i < contactInPerson.length; i++) {
				if(i < contactInPerson.length-1) {contactInPersonVector+=contactInPerson[i]+",";}
				else {contactInPersonVector+=contactInPerson[i]+")";}
			}	
			contactPhoneVector = "c(";
			for(var i = 0;i < contactPhone.length; i++) {
				if(i < contactPhone.length-1) {contactPhoneVector+=contactPhone[i]+",";}
				else {contactPhoneVector+=contactPhone[i]+")";}
			}	
			industryContractorVector = "c(";
			for(var i = 0;i < industryContractor.length; i++) {
				if(i < industryContractor.length-1) {industryContractorVector+=industryContractor[i]+",";}
				else {industryContractorVector+=industryContractor[i]+")";}
			}
			industryManufacturerVector = "c(";
			for(var i = 0;i < industryManufacturer.length; i++) {
				if(i < industryManufacturer.length-1) {industryManufacturerVector+=industryManufacturer[i]+",";}
				else {industryManufacturerVector+=industryManufacturer[i]+")";}
			}	
			industryRestaurantVector = "c(";
			for(var i = 0;i < industryRestaurant.length; i++) {
				if(i < industryRestaurant.length-1) {industryRestaurantVector+=industryRestaurant[i]+",";}
				else {industryRestaurantVector+=industryRestaurant[i]+")";}
			}
			pitchGroupPurchasingVector = "c(";
			for(var i = 0;i < pitchGroupPurchasing.length; i++) {
				if(i < pitchGroupPurchasing.length-1) {pitchGroupPurchasingVector+=pitchGroupPurchasing[i]+",";}
				else {pitchGroupPurchasingVector+=pitchGroupPurchasing[i]+")";}
			}
			pitchNegotiatingVector = "c(";
			for(var i = 0;i < pitchNegotiating.length; i++) {
				if(i < pitchNegotiating.length-1) {pitchNegotiatingVector+=pitchNegotiating[i]+",";}
				else {pitchNegotiatingVector+=pitchNegotiating[i]+")";}
			}
			pitchLowerPriceVector = "c(";
			for(var i = 0;i < pitchLowerPrice.length; i++) {
				if(i < pitchLowerPrice.length-1) {pitchLowerPriceVector+=pitchLowerPrice[i]+",";}
				else {pitchLowerPriceVector+=pitchLowerPrice[i]+")";}
			}	

			var regressionSnip = "userVector="+userVector+'\n';

			if($('#RevenueCheck').is(':checked')) {
				var nameOfField = $('#RevenueCheck').val();
				var valueOfField = $('input[name="RevenueInput"]').val();
				regressionSnip+="revenueVector="+revenueVector+'\n';

			}
			if($('#AgeCheck').is(':checked')) {
				var nameOfField = $('#AgeCheck').val();
				var valueOfField = $('input[name="AgeInput"]').val();
				regressionSnip+="ageVector="+ageVector+'\n';

			}
			if($('#EmployeesCheck').is(':checked')) {
				var nameOfField = $('#EmployeesCheck').val();
				var valueOfField = $('input[name="EmployeesInput"]').val();
				regressionSnip+="employeesVector="+employeesVector+'\n';


			}
			if($('#SectorCheck').is(':checked')) {
				var nameOfField = $('#SectorCheck').val();
				var valueOfField = $('input[name="SectorInput"]').val();
				regressionSnip+="sectorIndustrialVector="+sectorIndustrialVector+'\n'
				regressionSnip+="sectorServiceVector="+sectorServiceVector+'\n';

			}
			if($('#IndustryCheck').is(':checked')) {
				var nameOfField = $('#IndustryCheck').val();
				var valueOfField = $('input[name="IndustryInput"]').val();
				regressionSnip+="industryRestaurantVector="+industryRestaurantVector+'\n';
				regressionSnip+="industryManufacturerVector="+industryManufacturerVector+'\n';
				regressionSnip+="industryContractorVector="+industryContractorVector+'\n';

			}
			// if($('#ProductCheck').is(':checked')) {
			// 	var nameOfField = $('#ProductCheck').val();
			// 	var valueOfField = $('input[name="ProductInput"]').val();
			//	regressionSnip+="revenueVector="+revenueVector;

			// }	
			if($('#ContactMethodCheck').is(':checked')) {
				var nameOfField = $('#ContactMethodCheck').val();
				var valueOfField = $('input[name="ContactMethodInput"]').val();
				regressionSnip+="contactEmailVector="+contactEmailVector+'\n';
				regressionSnip+="contactPhoneVector="+contactPhoneVector+'\n';
				regressionSnip+="contactInPersonVector="+contactInPersonVector+'\n';

			}
			if($('#SexCheck').is(':checked')) {
				var nameOfField = $('#SexCheck').val();
				var valueOfField = $('input[name="SexInput"]').val();
				regressionSnip+="sexMVector="+sexMVector+'\n';


			}		
			if($('#PersonalRelationshipCheck').is(':checked')) {
				var nameOfField = $('#PersonalRelationshipCheck').val();
				var valueOfField = $('input[name="PersonalRelationshipInput"]').val();
				regressionSnip+="relationshipVector="+relationshipVector+'\n';

			}	
			if($('#PitchCheck').is(':checked')) {
				var nameOfField = $('#PitchCheck').val();
				var valueOfField = $('input[name="PitchInput"]').val();
				regressionSnip+="pitchNegotiatingVector="+pitchNegotiatingVector+'\n';
				regressionSnip+="pitchGroupPurchasingVector="+pitchGroupPurchasingVector+'\n';
				regressionSnip+="pitchLowerPriceVector="+pitchLowerPriceVector+'\n';

			}		

			regressionSnip+="testmodel<-glm(userVector~";

			var tempString = "";                               
			if($('#RevenueCheck').is(':checked')) {tempString+="+revenueVector";}
			if($('#AgeCheck').is(':checked')) {tempString+="+ageVector";}
			if($('#EmployeesCheck').is(':checked')) {tempString+="+employeesVector";}
			if($('#SectorCheck').is(':checked')) {tempString+="+sectorServiceVector+sectorIndustrialVector";}
			if($('#IndustryCheck').is(':checked')) {tempString+="+industryManufacturerVector+industryContractorVector+industryRestaurantVector";}
			//if($('#ProductCheck').is(':checked')) {tempString+="";}	
			if($('#ContactMethodCheck').is(':checked')) {tempString+="+contactInPersonVector+contactPhoneVector+contactEmailVector";}
			if($('#SexCheck').is(':checked')) {tempString+="+sexMVector";}		
			if($('#PersonalRelationshipCheck').is(':checked')) {tempString+="+relationshipVector";}	
			if($('#PitchCheck').is(':checked')) {tempString+="+pitchLowerPriceVector+pitchGroupPurchasingVector+pitchNegotiatingVector";}	
			tempString = tempString.substring(1);

			regressionSnip+=tempString;
			regressionSnip+=",family = binomial(link='logit'))\nsummary(testmodel)";		

			regressionSnip = new ocpu.Snippet(regressionSnip);

			var vectorsString = new ocpu.Snippet("userVector="+userVector+'\n'+"employeesVector="+employeesVector+'\n'+"contactEmailVector="+contactEmailVector+'\n'+"contactInPersonVector="+contactInPersonVector+'\n'+"contactPhoneVector="+contactPhoneVector+'\n'+"industryContractorVector="+industryContractorVector+'\n'+"industryManufacturerVector="+industryManufacturerVector+'\n'+"industryRestaurantVector="+industryRestaurantVector+'\n'+"pitchGroupPurchasingVector="+pitchGroupPurchasingVector+'\n'+"pitchNegotiatingVector="+pitchNegotiatingVector+'\n'+"titleVPVector="+titleVPVector+'\n'+"titlePurchaserVector="+titlePurchaserVector+'\n'+"titleOwnerVector="+titleOwnerVector+'\n'+"sexMVector="+sexMVector+'\n'+"sectorServiceVector="+sectorServiceVector+'\n'+"sectorIndustrialVector="+sectorIndustrialVector+'\n'+"relationshipVector="+relationshipVector+'\n'+"pitchLowerPriceVector="+pitchLowerPriceVector+'\n'+"ageVector="+ageVector+'\n'+"revenueVector="+revenueVector+"\ntestmodel<-glm(userVector~ageVector+revenueVector+contactInPersonVector+contactEmailVector+contactPhoneVector+industryContractorVector+industryManufacturerVector+industryRestaurantVector+pitchLowerPriceVector+pitchNegotiatingVector+pitchGroupPurchasingVector+titleVPVector+titlePurchaserVector+titleOwnerVector+sexMVector+sectorServiceVector+sectorIndustrialVector+relationshipVector+employeesVector,family = binomial(link='logit'))\nsummary(testmodel)");

			$("#rSubmit").on("click", function(){

			    var mysnippet = new ocpu.Snippet("a = c(1,2,3)\nb = c(2,3,4)\nc = c(0,1,0)\nd = c(0,1,0)\ne = c(0,1,0)\nf = c(0,1,0)\ng = c(0,1,0)\nh = c(0,1,0)\ni = c(0,1,0)\nj = c(0,1,0)\nk = c(0,1,0)\nl = c(0,1,0)\nm = c(0,1,0)\ntestmodel<-glm(m~a+b+c+d+e+f+g+h+i+j+k+l,family = binomial(link='logit'))\nsummary(testmodel)");

			    //disable button
			    $("button").attr("disabled", "disabled");

				var req = ocpu.call("identity", {"x" : regressionSnip}, function(session){
						session.getConsole(function(result){
								$("#output").text(result);
								var resultSplit = result.split("\n");
								for(var i = 86; i < resultSplit.length; i++) {
									var lineSplit = resultSplit[i].split(/\ +/);
								}
						});
				});
			    req.fail(function(){
			        alert("Server error: " + req.responseText);
			    });
			    req.always(function(){
			        $("button").removeAttr("disabled");
			    });
			});

		}

	//because identity is in base

	</script>

</head>

<body>

	<br /> <button id="rSubmit" type="button">Call R</button>

	<pre><code id="output"></code></pre>
<!-- 	<iframe width='100%' height='300' src='http://www.r-fiddle.org/#/embed?id=RIisIuHT' allowfullscreen='allowfullscreen' frameborder='0'></iframe> -->
	<div class = "mainContainer">
		<div class = "title">
			<h1>Fypus</h1>
		</div>

		<div class = "formDiv">

			<input placeholder = "Revenue" type="number" name="RevenueInput" min="0" max="1000000000000">
			<input type="checkbox" id="RevenueCheck" name="Revenue" value="Revenue" checked>

			<script>			

			$( document ).ready(function() {

				$("#submit").on("click", function() {

						var fieldsToRegress = [];
						var checkedFields = [];
						if($('#RevenueCheck').is(':checked')) {
							var nameOfField = $('#RevenueCheck').val();
							var valueOfField = $('input[name="RevenueInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);
						}
						if($('#AgeCheck').is(':checked')) {
							var nameOfField = $('#AgeCheck').val();
							var valueOfField = $('input[name="AgeInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}
						if($('#EmployeesCheck').is(':checked')) {
							var nameOfField = $('#EmployeesCheck').val();
							var valueOfField = $('input[name="EmployeesInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}
						if($('#SectorCheck').is(':checked')) {
							var nameOfField = $('#SectorCheck').val();
							var valueOfField = $('input[name="SectorInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}
						if($('#IndustryCheck').is(':checked')) {
							var nameOfField = $('#IndustryCheck').val();
							var valueOfField = $('input[name="IndustryInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}
						// if($('#ProductCheck').is(':checked')) {
						// 	var nameOfField = $('#ProductCheck').val();
						// 	var valueOfField = $('input[name="ProductInput"]').val();
						// 	fieldsToRegress.push({[nameOfField] : valueOfField});
						// 	checkedFields.push(nameOfField);

						// }	
						if($('#ContactMethodCheck').is(':checked')) {
							var nameOfField = $('#ContactMethodCheck').val();
							var valueOfField = $('input[name="ContactMethodInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}
						if($('#SexCheck').is(':checked')) {
							var nameOfField = $('#SexCheck').val();
							var valueOfField = $('input[name="SexInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}		
						if($('#PersonalRelationshipCheck').is(':checked')) {
							var nameOfField = $('#PersonalRelationshipCheck').val();
							var valueOfField = $('input[name="PersonalRelationshipInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}	
						if($('#PitchCheck').is(':checked')) {
							var nameOfField = $('#PitchCheck').val();
							var valueOfField = $('input[name="PitchInput"]').val();
							fieldsToRegress.push({[nameOfField] : valueOfField});
							checkedFields.push(nameOfField);

						}																
						console.log(checkedFields);

				})
			})

			</script>

			<input placeholder = "Age" type="number" name="AgeInput" min="1" max="100">
		    <input type="checkbox" id="AgeCheck" name="Age" value="Age" checked>

			<input placeholder = "Employees" type="number" name="EmployeesInput" min="0" max="100000">
		    <input type="checkbox" id="EmployeesCheck" name="Employees" value="Employees" checked>

			<select name="SectorInput">
			  <option value="" disabled selected>Sector</option>
			  <option value="2">Public</option>
			  <option value="1">Service</option>
			  <option value="0">Industrial</option>
			  <option value="3">Other</option>
			</select>
		    <input type="checkbox" id="SectorCheck" name="Sector" value="Sector" checked>

			<select name="IndustryInput">
			  <option value="" disabled selected>Industry</option>
			  <option value="0">Restaurant</option>
			  <option value="1">Contractor</option>
			  <option value="2">Manufacturer</option>
			  <option value="3">Government</option>
			  <option value="4">Distributor</option>
			  <option value="5">Other</option>
			</select>	
		    <input type="checkbox" id="IndustryCheck" name="Industry" value="Industry" checked>

<!-- 			<select name="ProductInput">
			  <option value="" disabled selected>Product</option>
			  <option value="0">Paper</option>
			  <option value="1">Steel</option>
			  <option value="2">Office Products</option>
			  <option value="3">Cleaning Supplies</option>
			  <option value="4">Shipping</option>
			  <option value="5">Swipe Fees</option>
			  <option value="6">Other</option>
			</select>	
		    <input type="checkbox" id="ProductCheck" name="Product" value="Product" checked> -->

			<select name="ContactMethodInput">
			  <option value="" disabled selected>Contact Method</option>
			  <option value="2">Phone</option>
			  <option value="1">Email</option>
			  <option value="0">In-Person</option>
			  <option value="3">Other</option>
			</select>
		    <input type="checkbox" id="ContactMethodCheck" name="ContactMethod" value="ContactMethod" checked>

			<select name="SexInput">
			  <option value="" disabled selected>Sex</option>
			  <option value="1">Male</option>
			  <option value="0">Female</option>
			  <option value="2">Other</option>
			</select>	
		    <input type="checkbox" id="SexCheck" name="Sex" value="Sex" checked>

			<select name="PersonalRelationshipInput">
			  <option value="" disabled selected>Has Personal Relationship?</option>
			  <option value="1">Yes</option>
			  <option value="0">No</option>
			</select>	
		    <input type="checkbox" id="PersonalRelationshipCheck" name="PersonalRelationship" value="PersonalRelationship" checked>

			<select name="PitchInput">
			  <option value="" disabled selected>Pitch</option>
			  <option value="1">Group Purchasing</option>
			  <option value="0">Negotiating</option>
			  <option value = "2">Lower Price</option>
			</select>	
		    <input type="checkbox" id="PitchCheck" name="Pitch" value="Pitch" checked>

			<input id = "submit" type = "submit"></button>
		</div>

		<div class  = "resultsDiv">	
		</div>

	</div>

</body>
</html>